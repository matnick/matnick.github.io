(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{175:function(t,s,a){"use strict";a.r(s);var n=a(0),o=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"примеры-драйверов"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#примеры-драйверов","aria-hidden":"true"}},[t._v("#")]),t._v(" Примеры драйверов")]),t._v(" "),a("h2",{attrs:{id:"пример-драйвера-работающего-через-http"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#пример-драйвера-работающего-через-http","aria-hidden":"true"}},[t._v("#")]),t._v(" Пример драйвера, работающего через HTTP")]),t._v(" "),a("p",[t._v("Пример драйвера, который получает значения о качестве воздуха с сервера в JSON и отправляет в шину. Проверки на корректность данных и http-код ответа опущены.")]),t._v(" "),a("div",{staticClass:"language-lua extra-class"},[a("pre",{pre:!0,attrs:{class:"language-lua"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("local")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("get_values")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("local")]),t._v(" client "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" require"),a("span",{attrs:{class:"token string"}},[t._v("'http.client'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("new")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("local")]),t._v(" http_result "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" client"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token function"}},[t._v("post")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'http://exapble.com/sensors/pm/last.php'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("local")]),t._v(" decoded_data "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'json'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("decode")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("http_result"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n   "),a("span",{attrs:{class:"token function"}},[t._v("set_value")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"/air/pm25"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" decoded_data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pm25"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{attrs:{class:"token function"}},[t._v("set_value")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"/air/pm10"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" decoded_data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pm10"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("local")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("main_loop")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("true")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n      "),a("span",{attrs:{class:"token function"}},[t._v("get_values")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      fiber"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("sleep")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("60")]),a("span",{attrs:{class:"token operator"}},[t._v("*")]),a("span",{attrs:{class:"token number"}},[t._v("5")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("init")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   store"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fiber_object "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" fiber"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("create")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main_loop"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("destroy")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("store"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fiber_object"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token function"}},[t._v("status")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("~=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"dead"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n      store"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fiber_object"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token function"}},[t._v("cancel")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),a("h2",{attrs:{id:"пример-драйвера-работающего-через-mqtt-с-обратным-распространением-данных"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#пример-драйвера-работающего-через-mqtt-с-обратным-распространением-данных","aria-hidden":"true"}},[t._v("#")]),t._v(" Пример драйвера, работающего через MQTT с обратным распространением данных")]),t._v(" "),a("p",[t._v('Пример драйвера c MQTT и обратным распространением данных: при изменении значения топика "/ud/1674/lora/commands" в bus, будет отправлено сообщение в MQTT.')]),t._v(" "),a("div",{staticClass:"language-lua extra-class"},[a("pre",{pre:!0,attrs:{class:"language-lua"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("local")]),t._v(" mqtt_host "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"mosquitto"')]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("local")]),t._v(" mqtt_port "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1883")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("local")]),t._v(" mqtt_name "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"glue_"')]),a("span",{attrs:{class:"token operator"}},[t._v("..")]),t._v("_script_name"),a("span",{attrs:{class:"token operator"}},[t._v("..")]),a("span",{attrs:{class:"token string"}},[t._v('"_"')]),a("span",{attrs:{class:"token operator"}},[t._v("..")]),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'system'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("random_string")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("local")]),t._v(" mqtt_object\ntopics "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token string"}},[t._v('"/ud/1674/lora/commands"')]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("local")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("driver_mqtt_callback")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message_id"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" topic"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" payload"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qos"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" retain"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("nil")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("then")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("local")]),t._v(" data "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("decode")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("local")]),t._v(" lora_data "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   _"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lora_data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serial"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lora_data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("device_type  "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" string"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("find")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("topic"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"devices/lora/(.+)/(.+)"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("nil")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("or")]),t._v(" data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("nil")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("or")]),t._v(" data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("nil")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("then")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lora_data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serial "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("nil")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("or")]),t._v(" lora_data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("device_type "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("nil")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("then")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n   "),a("span",{attrs:{class:"token function"}},[t._v("set_value")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"/ud/1674/lora/"')]),a("span",{attrs:{class:"token operator"}},[t._v("..")]),t._v("lora_data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serial"),a("span",{attrs:{class:"token operator"}},[t._v("..")]),a("span",{attrs:{class:"token string"}},[t._v('"/"')]),a("span",{attrs:{class:"token operator"}},[t._v("..")]),a("span",{attrs:{class:"token string"}},[t._v('"temperature/1"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("tonumber")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("s1"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{attrs:{class:"token function"}},[t._v("set_value")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"/ud/1674/lora/"')]),a("span",{attrs:{class:"token operator"}},[t._v("..")]),t._v("lora_data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serial"),a("span",{attrs:{class:"token operator"}},[t._v("..")]),a("span",{attrs:{class:"token string"}},[t._v('"/"')]),a("span",{attrs:{class:"token operator"}},[t._v("..")]),a("span",{attrs:{class:"token string"}},[t._v('"rssi"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("tonumber")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rssi"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{attrs:{class:"token function"}},[t._v("set_value")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"/ud/1674/lora/"')]),a("span",{attrs:{class:"token operator"}},[t._v("..")]),t._v("lora_data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serial"),a("span",{attrs:{class:"token operator"}},[t._v("..")]),a("span",{attrs:{class:"token string"}},[t._v('"/"')]),a("span",{attrs:{class:"token operator"}},[t._v("..")]),a("span",{attrs:{class:"token string"}},[t._v('"battery"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("tonumber")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("battery"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("init")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("local")]),t._v(" conn "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" socket"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("tcp_connect")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mqtt_host"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mqtt_port"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("conn "),a("span",{attrs:{class:"token operator"}},[t._v("~=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("nil")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n      conn"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token function"}},[t._v("close")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      mqtt_object "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" mqtt"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("new")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mqtt_name"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("local")]),t._v(" mqtt_status"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mqtt_err "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" mqtt_object"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token function"}},[t._v("connect")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("host"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("mqtt_host"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("mqtt_port"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mqtt_status "),a("span",{attrs:{class:"token operator"}},[t._v("~=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n         "),a("span",{attrs:{class:"token function"}},[t._v("error")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'MQTT error '")]),a("span",{attrs:{class:"token operator"}},[t._v("..")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mqtt_err "),a("span",{attrs:{class:"token keyword"}},[t._v("or")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"unknown error"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n         mqtt_object"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token function"}},[t._v("on_message")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("driver_mqtt_callback"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n         mqtt_object"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token function"}},[t._v("subscribe")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'/devices/lora/#'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n      "),a("span",{attrs:{class:"token function"}},[t._v("error")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'Connect to host '")]),a("span",{attrs:{class:"token operator"}},[t._v("..")]),t._v("mqtt_host"),a("span",{attrs:{class:"token operator"}},[t._v("..")]),a("span",{attrs:{class:"token string"}},[t._v("' failed'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("topic_update_callback")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" topic"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   mqtt_object"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token function"}},[t._v("publish")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'devices/lora/commands'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mqtt"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("QOS_0"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mqtt"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RETAIN"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("destroy")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("false")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])])])}],!1,null,null,null);o.options.__file="examples_driver.md";s.default=o.exports}}]);